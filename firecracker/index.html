
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="canonical" href="https://omussell.github.io/firecracker/">
      
      <link rel="icon" href="../images/mention.svg">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-7.3.4">
    
    
      
        <title>Firecracker - Personal Site</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.db9e7362.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.3f5d1f46.min.css">
        
          
          
          <meta name="theme-color" content="#2094f3">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
    
      


    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="blue" data-md-color-accent="">
  
    
    <script>function __prefix(e){return new URL("..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#firecracker" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Personal Site" class="md-header__button md-logo" aria-label="Personal Site" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4.75 2.37a6.5 6.5 0 0 0 6.5 11.26.75.75 0 0 1 .75 1.298 8 8 0 1 1 3.994-7.273.754.754 0 0 1 .006.095v1.5a2.75 2.75 0 0 1-5.072 1.475A4 4 0 1 1 12 8v1.25a1.25 1.25 0 0 0 2.5 0V7.867a6.5 6.5 0 0 0-9.75-5.496V2.37zM10.5 8a2.5 2.5 0 1 0-5 0 2.5 2.5 0 0 0 5 0z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Personal Site
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Firecracker
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Personal Site" class="md-nav__button md-logo" aria-label="Personal Site" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4.75 2.37a6.5 6.5 0 0 0 6.5 11.26.75.75 0 0 1 .75 1.298 8 8 0 1 1 3.994-7.273.754.754 0 0 1 .006.095v1.5a2.75 2.75 0 0 1-5.072 1.475A4 4 0 1 1 12 8v1.25a1.25 1.25 0 0 0 2.5 0V7.867a6.5 6.5 0 0 0-9.75-5.496V2.37zM10.5 8a2.5 2.5 0 1 0-5 0 2.5 2.5 0 0 0 5 0z"/></svg>

    </a>
    Personal Site
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          Old Posts
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Old Posts" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Old Posts
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../jail-creation/" class="md-nav__link">
        FreeBSD Jail Creation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../bhyve-vm-creation/" class="md-nav__link">
        Bhyve VM Creation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../nginx-chacha20/" class="md-nav__link">
        Compiling NGINX with ChaCha20 support
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../nsd-unbound/" class="md-nav__link">
        NSD and Unbound config
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../saltstack/" class="md-nav__link">
        Saltstack install and config
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../pgsql-repl/" class="md-nav__link">
        PostgreSQL 10.1 with replication
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../go-bazel/" class="md-nav__link">
        Building Go with Bazel
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../rqlite/" class="md-nav__link">
        RQLite
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../signify/" class="md-nav__link">
        Signify
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../nginx/" class="md-nav__link">
        NGINX
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../quick-k8s/" class="md-nav__link">
        Quick Multi-Node Kubernetes Cluster
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../serverless/" class="md-nav__link">
        Serverless
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../fbsd-update-cache/" class="md-nav__link">
        Caching freebsd-update and pkg files
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../pi-bitwarden/" class="md-nav__link">
        Pi Bitwarden
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../gemini/" class="md-nav__link">
        Gemini
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../puppet-bolt/" class="md-nav__link">
        Puppet Bolt
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../microserver/" class="md-nav__link">
        Microserver NAS
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../lxc/" class="md-nav__link">
        LXC/LXD Containers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../python/" class="md-nav__link">
        Modern Python
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../new-prog-lang/" class="md-nav__link">
        Find a New Programming Language
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../lean/" class="md-nav__link">
        Lean
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Firecracker
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Firecracker
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#quickstart" class="md-nav__link">
    Quickstart
  </a>
  
    <nav class="md-nav" aria-label="Quickstart">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#get-firecracker" class="md-nav__link">
    Get firecracker
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-the-kernel-and-rootfs" class="md-nav__link">
    Get the kernel and rootfs
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-firectl" class="md-nav__link">
    Using firectl
  </a>
  
    <nav class="md-nav" aria-label="Using firectl">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#get-firectl" class="md-nav__link">
    Get firectl
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-microvm" class="md-nav__link">
    Create microvm
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-the-api" class="md-nav__link">
    Using the API
  </a>
  
    <nav class="md-nav" aria-label="Using the API">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#set-the-guest-kernel" class="md-nav__link">
    Set the guest kernel
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#set-the-guest-rootf" class="md-nav__link">
    Set the guest rootf
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#start-the-guest-machine" class="md-nav__link">
    Start the guest machine
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#compile-kernel-and-fs-manually" class="md-nav__link">
    Compile Kernel and FS manually
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-the-jailer" class="md-nav__link">
    Using the jailer
  </a>
  
    <nav class="md-nav" aria-label="Using the jailer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#install" class="md-nav__link">
    Install
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#run" class="md-nav__link">
    Run
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#notes-from-running-the-jailer-manually" class="md-nav__link">
    Notes from running the jailer manually
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../puppet-jails-deploy/" class="md-nav__link">
        Blue/Green deploymetns with Puppet, NGINX and FreeBSD Jails
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../bonded-nic/" class="md-nav__link">
        Bonded NICs on Ubuntu
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../basecamp/" class="md-nav__link">
        Basecamp books
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#quickstart" class="md-nav__link">
    Quickstart
  </a>
  
    <nav class="md-nav" aria-label="Quickstart">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#get-firecracker" class="md-nav__link">
    Get firecracker
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-the-kernel-and-rootfs" class="md-nav__link">
    Get the kernel and rootfs
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-firectl" class="md-nav__link">
    Using firectl
  </a>
  
    <nav class="md-nav" aria-label="Using firectl">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#get-firectl" class="md-nav__link">
    Get firectl
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-microvm" class="md-nav__link">
    Create microvm
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-the-api" class="md-nav__link">
    Using the API
  </a>
  
    <nav class="md-nav" aria-label="Using the API">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#set-the-guest-kernel" class="md-nav__link">
    Set the guest kernel
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#set-the-guest-rootf" class="md-nav__link">
    Set the guest rootf
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#start-the-guest-machine" class="md-nav__link">
    Start the guest machine
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#compile-kernel-and-fs-manually" class="md-nav__link">
    Compile Kernel and FS manually
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-the-jailer" class="md-nav__link">
    Using the jailer
  </a>
  
    <nav class="md-nav" aria-label="Using the jailer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#install" class="md-nav__link">
    Install
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#run" class="md-nav__link">
    Run
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#notes-from-running-the-jailer-manually" class="md-nav__link">
    Notes from running the jailer manually
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="firecracker">Firecracker<a class="headerlink" href="#firecracker" title="Permanent link">&para;</a></h1>
<p><a href="https://github.com/firecracker-microvm/firecracker">Firecracker</a> - Secure and fast microVMs for serverless computing.</p>
<h2 id="quickstart">Quickstart<a class="headerlink" href="#quickstart" title="Permanent link">&para;</a></h2>
<p><a href="https://github.com/firecracker-microvm/firecracker/blob/main/docs/getting-started.md">Quickstart</a></p>
<h3 id="get-firecracker">Get firecracker<a class="headerlink" href="#get-firecracker" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>release_url=&quot;https://github.com/firecracker-microvm/firecracker/releases&quot;
latest=$(basename $(curl -fsSLI -o /dev/null -w  %{url_effective} ${release_url}/latest))
curl -L ${release_url}/download/${latest}/firecracker-${latest}-x86_64.tgz | tar -xz
</code></pre></div>
<h3 id="get-the-kernel-and-rootfs">Get the kernel and rootfs<a class="headerlink" href="#get-the-kernel-and-rootfs" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code># Official instructions

dest_kernel=&quot;hello-vmlinux.bin&quot;
dest_rootfs=&quot;hello-rootfs.ext4&quot;
image_bucket_url=&quot;https://s3.amazonaws.com/spec.ccfc.min/img/quickstart_guide/x86_64&quot;


kernel=&quot;${image_bucket_url}/kernels/vmlinux.bin&quot;
rootfs=&quot;${image_bucket_url}/rootfs/bionic.rootfs.ext4&quot;

curl -fsSL -o $dest_kernel $kernel
curl -fsSL -o $dest_rootfs $rootfs



# Same but with a recently built image as gleaned from the bucket list
dest_kernel=&quot;hello-vmlinux.bin&quot;
dest_rootfs=&quot;hello-rootfs.ext4&quot;
kernel=&quot;https://s3.amazonaws.com/spec.ccfc.min/img-dev/x86_64/ubuntu/kernel/vmlinux.bin&quot;
rootfs=&quot;https://s3.amazonaws.com/spec.ccfc.min/img-dev/x86_64/ubuntu/fsfiles/bionic.rootfs.ext4&quot;
curl -fsSL -o $dest_kernel $kernel
curl -fsSL -o $dest_rootfs $rootfs
</code></pre></div>
<h2 id="using-firectl">Using firectl<a class="headerlink" href="#using-firectl" title="Permanent link">&para;</a></h2>
<h3 id="get-firectl">Get firectl<a class="headerlink" href="#get-firectl" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>curl -Lo firectl https://firectl-release.s3.amazonaws.com/firectl-v0.1.0
chmod +x firectl
</code></pre></div>
<h3 id="create-microvm">Create microvm<a class="headerlink" href="#create-microvm" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>./firectl \
  --kernel=hello-vmlinux.bin \
  --root-drive=hello-rootfs.ext4
</code></pre></div>
<h2 id="using-the-api">Using the API<a class="headerlink" href="#using-the-api" title="Permanent link">&para;</a></h2>
<h3 id="set-the-guest-kernel">Set the guest kernel<a class="headerlink" href="#set-the-guest-kernel" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>kernel_path=$(pwd)&quot;/hello-vmlinux.bin&quot;

curl --unix-socket /tmp/firecracker.socket -i \
  -X PUT &#39;http://localhost/boot-source&#39;   \
  -H &#39;Accept: application/json&#39;           \
  -H &#39;Content-Type: application/json&#39;     \
  -d &quot;{
        \&quot;kernel_image_path\&quot;: \&quot;${kernel_path}\&quot;,
        \&quot;boot_args\&quot;: \&quot;console=ttyS0 reboot=k panic=1 pci=off\&quot;
   }&quot;
</code></pre></div>
<h3 id="set-the-guest-rootf">Set the guest rootf<a class="headerlink" href="#set-the-guest-rootf" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>rootfs_path=$(pwd)&quot;/hello-rootfs.ext4&quot;
curl --unix-socket /tmp/firecracker.socket -i \
  -X PUT &#39;http://localhost/drives/rootfs&#39; \
  -H &#39;Accept: application/json&#39;           \
  -H &#39;Content-Type: application/json&#39;     \
  -d &quot;{
        \&quot;drive_id\&quot;: \&quot;rootfs\&quot;,
        \&quot;path_on_host\&quot;: \&quot;${rootfs_path}\&quot;,
        \&quot;is_root_device\&quot;: true,
        \&quot;is_read_only\&quot;: false
   }&quot;
</code></pre></div>
<h3 id="start-the-guest-machine">Start the guest machine<a class="headerlink" href="#start-the-guest-machine" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>curl --unix-socket /tmp/firecracker.socket -i \
  -X PUT &#39;http://localhost/actions&#39;       \
  -H  &#39;Accept: application/json&#39;          \
  -H  &#39;Content-Type: application/json&#39;    \
  -d &#39;{
      &quot;action_type&quot;: &quot;InstanceStart&quot;
   }&#39;
</code></pre></div>
<h2 id="compile-kernel-and-fs-manually">Compile Kernel and FS manually<a class="headerlink" href="#compile-kernel-and-fs-manually" title="Permanent link">&para;</a></h2>
<p>Follow the steps in <a href="https://github.com/firecracker-microvm/firecracker/blob/master/docs/rootfs-and-kernel-setup.md">here</a> to compile the kernel and base file. </p>
<p>On Ubuntu when compiling you need to install dependencies like libssl-dev, libncurses-dev, bison, autoconf.</p>
<p>Then if you try and compile and it complains about auto.conf not existing, run make menuconfig, then exit out immediately. That seems to have sorted it.</p>
<p>Then when you run make vmlinux it asks lots of questions, but by using the preexisting config file from the repo a lot has already been decided. You could probably pipe yes into this, or otherwise just hold enter. Someone with more kernel experience needs to go over those options and decide if they're necessary. </p>
<p>Once compiled continue with the getting started instructions but change the path to the kernel file to the vmlinux you created.</p>
<p>I compiled 5.4 kernel and used the existing alpine base from the getting started and it boots just fine.</p>
<h2 id="using-the-jailer">Using the jailer<a class="headerlink" href="#using-the-jailer" title="Permanent link">&para;</a></h2>
<h3 id="install">Install<a class="headerlink" href="#install" title="Permanent link">&para;</a></h3>
<p>The jailer is used to provide additional isolation for the VMs.</p>
<p>The jailer binary is included in the tgz file from the firecracker release.</p>
<div class="highlight"><pre><span></span><code># It needs to be built statically linked to musl.

apt install -y musl-tools

# install rust via rustup

# cd into the jailer directory in the firecracker repo
cargo build --target=&quot;x86_64-unknown-linux-musl&quot; --release

# the built binary gets created at:
../../build/cargo_target/x86_64-unknown-linux-musl/release/jailer

# you should probably build with tools/devtool build instead
</code></pre></div>
<h3 id="run">Run<a class="headerlink" href="#run" title="Permanent link">&para;</a></h3>
<p>Rather than running the jailer binary manually, you can use the <code>--jailer</code> flag with firectl. Note that you must also include the <code>--chroot-base-dir="/srv/jailer"</code> flag, otherwise you get the <code>no such file or directory</code> error as per <a href="https://github.com/firecracker-microvm/firecracker-go-sdk/issues/313">this issue</a>.</p>
<p>You also need to copy or move the firectl, firecracker, and jailer binaries into a bin directory in your $PATH otherwise it complains. I copied them to /usr/local/bin</p>
<div class="highlight"><pre><span></span><code>/usr/local/bin/firectl --kernel=/root/release-v0.25.2-x86_64/hello-vmlinux.bin --root-drive=/root/release-v0.25.2-x86_64/hello-rootfs.ext4 --jailer=/usr/local/bin/jailer --exec-file=/usr/local/bin/firecracker --id=testvm4 --chroot-base-dir=&quot;/srv/jailer&quot;
</code></pre></div>
<p>Firectl also doesnt handle cleaning up the /srv/jailer/firecracker/$vm_name chroot directory when you power off the VM. So you need to clean this up manually.</p>
<h2 id="notes-from-running-the-jailer-manually">Notes from running the jailer manually<a class="headerlink" href="#notes-from-running-the-jailer-manually" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code>cp -v rootfs.ext4 /srv/jailer/firecracker/551e7604-e35c-42b3-b825-416853441234/root/
cp -v vmlinux.bin /srv/jailer/firecracker/551e7604-e35c-42b3-b825-416853441234/root/
ls /srv/jailer/firecracker/551e7604-e35c-42b3-b825-416853441234/
ls /srv/jailer/firecracker/551e7604-e35c-42b3-b825-416853441234/root/run/firecracker.socket 
ls /srv/jailer/firecracker/551e7604-e35c-42b3-b825-416853441234/root/
</code></pre></div>
<div class="highlight"><pre><span></span><code>curl --unix-socket /srv/jailer/firecracker/551e7604-e35c-42b3-b825-416853441234/root/run/firecracker.socket -i   -X PUT &#39;http://localhost/boot-source&#39;     -H &#39;Accept: application/json&#39;             -H &#39;Content-Type: application/json&#39;       -d &quot;{
        \&quot;kernel_image_path\&quot;: \&quot;/root/vmlinux.bin\&quot;,
        \&quot;boot_args\&quot;: \&quot;console=ttyS0 reboot=k panic=1 pci=off\&quot;
   }&quot;
ls /srv/jailer/firecracker/551e7604-e35c-42b3-b825-416853441234/root/vmlinux.bin 
curl --unix-socket /srv/jailer/firecracker/551e7604-e35c-42b3-b825-416853441234/root/run/firecracker.socket -i   -X PUT &#39;http://localhost/boot-source&#39;     -H &#39;Accept: application/json&#39;             -H &#39;Content-Type: application/json&#39;       -d &quot;{
        \&quot;kernel_image_path\&quot;: \&quot;/srv/jailer/firecracker/551e7604-e35c-42b3-b825-416853441234/root/vmlinux.bin\&quot;,
        \&quot;boot_args\&quot;: \&quot;console=ttyS0 reboot=k panic=1 pci=off\&quot;
   }&quot;
ls -alh /srv/jailer/firecracker/551e7604-e35c-42b3-b825-416853441234/root/
chown 1001:1111 /srv/jailer/firecracker/551e7604-e35c-42b3-b825-416853441234/root/vmlinux.bin 
chown 1001:1111 /srv/jailer/firecracker/551e7604-e35c-42b3-b825-416853441234/root/rootfs.ext4 
curl --unix-socket /srv/jailer/firecracker/551e7604-e35c-42b3-b825-416853441234/root/run/firecracker.socket -i   -X PUT &#39;http://localhost/boot-source&#39;     -H &#39;Accept: application/json&#39;             -H &#39;Content-Type: application/json&#39;       -d &quot;{
        \&quot;kernel_image_path\&quot;: \&quot;/srv/jailer/firecracker/551e7604-e35c-42b3-b825-416853441234/root/vmlinux.bin\&quot;,
        \&quot;boot_args\&quot;: \&quot;console=ttyS0 reboot=k panic=1 pci=off\&quot;
   }&quot;
curl --unix-socket /srv/jailer/firecracker/551e7604-e35c-42b3-b825-416853441234/root/run/firecracker.socket -i   -X PUT &#39;http://localhost/boot-source&#39;     -H &#39;Accept: application/json&#39;             -H &#39;Content-Type: application/json&#39;       -d &quot;{
        \&quot;kernel_image_path\&quot;: \&quot;/root/vmlinux.bin\&quot;,
        \&quot;boot_args\&quot;: \&quot;console=ttyS0 reboot=k panic=1 pci=off\&quot;
   }&quot;
ls -alh /srv/jailer/firecracker/551e7604-e35c-42b3-b825-416853441234/root/
curl --unix-socket /srv/jailer/firecracker/551e7604-e35c-42b3-b825-416853441234/root/run/firecracker.socket -i   -X PUT &#39;http://localhost/boot-source&#39;     -H &#39;Accept: application/json&#39;             -H &#39;Content-Type: application/json&#39;       -d &quot;{
        \&quot;kernel_image_path\&quot;: \&quot;/root/vmlinux.bin\&quot;,
        \&quot;boot_args\&quot;: \&quot;console=ttyS0 reboot=k panic=1 pci=off\&quot;
   }&quot;
ls -alh /srv/jailer/firecracker/551e7604-e35c-42b3-b825-416853441234/root/
ls /srv/jailer/firecracker/551e7604-e35c-42b3-b825-416853441234/
ls /srv/jailer/firecracker/551e7604-e35c-42b3-b825-416853441234/root/
curl --unix-socket /srv/jailer/firecracker/551e7604-e35c-42b3-b825-416853441234/root/run/firecracker.socket -i   -X PUT &#39;http://localhost/boot-source&#39;     -H &#39;Accept: application/json&#39;             -H &#39;Content-Type: application/json&#39;       -d &quot;{
        \&quot;kernel_image_path\&quot;: \&quot;./vmlinux.bin\&quot;,
        \&quot;boot_args\&quot;: \&quot;console=ttyS0 reboot=k panic=1 pci=off\&quot;
   }&quot;
curl --unix-socket /srv/jailer/firecracker/551e7604-e35c-42b3-b825-416853441234/root/run/firecracker.socket -i   -X PUT &#39;http://localhost/drives/rootfs&#39;   -H &#39;Accept: application/json&#39;             -H &#39;Content-Type: application/json&#39;       -d &quot;{
        \&quot;drive_id\&quot;: \&quot;rootfs\&quot;,
        \&quot;path_on_host\&quot;: \&quot;./rootfs.ext4\&quot;,
        \&quot;is_root_device\&quot;: true,
        \&quot;is_read_only\&quot;: false
   }&quot;
curl --unix-socket /srv/jailer/firecracker/551e7604-e35c-42b3-b825-416853441234/root/run/firecracker.socket -i   -X PUT &#39;http://localhost/actions&#39;         -H  &#39;Accept: application/json&#39;            -H  &#39;Content-Type: application/json&#39;      -d &#39;{
      &quot;action_type&quot;: &quot;InstanceStart&quot;
   }&#39;
curl --unix-socket /srv/jailer/firecracker/551e7604-e35c-42b3-b825-416853441234/root/run/firecracker.socket -i   -X GET &#39;http://localhost/&#39;         -H  &#39;Accept: application/json&#39;            -H  &#39;Content-Type: application/json&#39;
curl --unix-socket /srv/jailer/firecracker/551e7604-e35c-42b3-b825-416853441234/root/run/firecracker.socket -i   -X PUT &#39;http://localhost/actions&#39;         -H  &#39;Accept: application/json&#39;            -H  &#39;Content-Type: application/json&#39;      -d &#39;{
      &quot;action_type&quot;: &quot;InstanceStop&quot;
   }&#39;
curl --unix-socket /srv/jailer/firecracker/551e7604-e35c-42b3-b825-416853441234/root/run/firecracker.socket -i   -X PUT &#39;http://localhost/actions&#39;         -H  &#39;Accept: application/json&#39;            -H  &#39;Content-Type: application/json&#39;      -d &#39;{
      &quot;action_type&quot;: &quot;InstanceStop&quot;
   }&#39;
curl --unix-socket /srv/jailer/firecracker/551e7604-e35c-42b3-b825-416853441234/root/run/firecracker.socket -i   -X PUT &#39;http://localhost/actions&#39;         -H  &#39;Accept: application/json&#39;            -H  &#39;Content-Type: application/json&#39;      -d &#39;{
      &quot;action_type&quot;: &quot;SendCtrlAltDel&quot;
   }&#39;
curl --unix-socket /srv/jailer/firecracker/551e7604-e35c-42b3-b825-416853441234/root/run/firecracker.socket -i   -X GET &#39;http://localhost/&#39;         -H  &#39;Accept: application/json&#39;            -H  &#39;Content-Type: application/json&#39;
ps aux | grep fire
ls /srv/jailer/firecracker/551e7604-e35c-42b3-b825-416853441234/root/
ls /srv/jailer/firecracker/551e7604-e35c-42b3-b825-416853441234/root/run/
</code></pre></div>
<div class="highlight"><pre><span></span><code>mkdir -p /srv/jailer
cp -v ./release-v1.1.2-x86_64/jailer-v1.1.2-x86_64 /usr/bin/jailer
ls -alh /usr/bin/jailer
ls /var/run/netns
ls /var/run
/usr/bin/jailer --id 551e7604-e35c-42b3-b825-416853441234 --exec-file /usr/bin/firecracker --daemonize
addgroup -G 1111 551e7604-e35c-42b3-b825-416853441234
addgroup ---gid 1111 551e7604-e35c-42b3-b825-416853441234
addgroup --gid 1111 551e7604
addgroup --gid 1111 551e7604-e35c-42b3-b825-416853441234
addgroup --gid 1111 551e7604
addgroup --gid 1111 5517604
addgroup --gid 1111 mygroupname
adduser
adduser myusername
/usr/bin/jailer --id 551e7604-e35c-42b3-b825-416853441234 --exec-file /usr/bin/firecracker --daemonize --uid 1001 --gid 1111
ls /usr/bin/firecracker
cp -v ./release-v1.1.2-x86_64/firecracker-v1.1.2-x86_64 /usr/bin/firecracker
/usr/bin/jailer --id 551e7604-e35c-42b3-b825-416853441234 --exec-file /usr/bin/firecracker --daemonize --uid 1001 --gid 1111
/usr/bin/jailer --id 551e7604-e35c-42b3-b825-416853441234 --exec-file /usr/bin/firecracker --uid 1001 --gid 1111 --daemonize
rm -rf /srv/jailer/firecracker/551e7604-e35c-42b3-b825-416853441234/
/usr/bin/jailer --id 551e7604-e35c-42b3-b825-416853441234 --exec-file /usr/bin/firecracker --uid 1001 --gid 1111 --daemonize
rm -rf /srv/jailer/firecracker/551e7604-e35c-42b3-b825-416853441234/
mkdir -p /srv/jailer/firecracker/551e7604-e35c-42b3-b825-416853441234/
chown 1001:1111 /srv/jailer/firecracker/551e7604-e35c-42b3-b825-416853441234/
ls -alh /srv/jailer/firecracker/551e7604-e35c-42b3-b825-416853441234/
/usr/bin/jailer --id 551e7604-e35c-42b3-b825-416853441234 --exec-file /usr/bin/firecracker --uid 1001 --gid 1111 --daemonize
mkdir -p /srv/jailer/firecracker/551e7604-e35c-42b3-b825-416853441234/root/
chown 1001:1111 /srv/jailer/firecracker/551e7604-e35c-42b3-b825-416853441234/root
/usr/bin/jailer --id 551e7604-e35c-42b3-b825-416853441234 --exec-file /usr/bin/firecracker --uid 1001 --gid 1111 --daemonize
rm /srv/jailer/firecracker/551e7604-e35c-42b3-b825-416853441234/dev/net/tun
rm -rf /srv/jailer/firecracker/551e7604-e35c-42b3-b825-416853441234/
mkdir -p /srv/jailer/firecracker/551e7604-e35c-42b3-b825-416853441234/root/
chown -R 1001:1111 /srv/jailer/firecracker/551e7604-e35c-42b3-b825-416853441234/
/usr/bin/jailer --id 551e7604-e35c-42b3-b825-416853441234 --exec-file /usr/bin/firecracker --uid 1001 --gid 1111 --daemonize
/usr/bin/jailer --id 551e7604-e35c-42b3-b825-416853441234 --exec-file /usr/bin/firecracker --uid 1001 --gid 1111 
rm -rf /srv/jailer/firecracker/551e7604-e35c-42b3-b825-416853441234/
mkdir -p /srv/jailer/firecracker/551e7604-e35c-42b3-b825-416853441234/root/
chown -R 1001:1111 /srv/jailer/firecracker/551e7604-e35c-42b3-b825-416853441234/
/usr/bin/jailer --id 551e7604-e35c-42b3-b825-416853441234 --exec-file /usr/bin/firecracker --uid 1001 --gid 1111 
</code></pre></div>
<div class="highlight"><pre><span></span><code>curl --unix-socket /srv/jailer/firecracker/551e7604-e35c-42b3-b825-416853441234/root/run/firecracker.socket -i   -X PUT &#39;http://localhost/boot-source&#39;     -H &#39;Accept: application/json&#39;             -H &#39;Content-Type: application/json&#39;       -d &quot;{
        \&quot;kernel_image_path\&quot;: \&quot;./vmlinux.bin\&quot;,
        \&quot;boot_args\&quot;: \&quot;console=ttyS0 reboot=k panic=1 pci=off\&quot;
   }&quot;
curl --unix-socket /srv/jailer/firecracker/551e7604-e35c-42b3-b825-416853441234/root/run/firecracker.socket -i   -X PUT &#39;http://localhost/drives/rootfs&#39;   -H &#39;Accept: application/json&#39;             -H &#39;Content-Type: application/json&#39;       -d &quot;{
        \&quot;drive_id\&quot;: \&quot;rootfs\&quot;,
        \&quot;path_on_host\&quot;: \&quot;./rootfs.ext4\&quot;,
        \&quot;is_root_device\&quot;: true,
        \&quot;is_read_only\&quot;: false
   }&quot;
curl --unix-socket /srv/jailer/firecracker/551e7604-e35c-42b3-b825-416853441234/root/run/firecracker.socket -i   -X PUT &#39;http://localhost/network-interfaces/eth0&#39;   -H &#39;Accept: application/json&#39;   -H &#39;Content-Type: application/json&#39;   -d &#39;{
      &quot;iface_id&quot;: &quot;eth0&quot;,
      &quot;host_dev_name&quot;: &quot;tap0&quot;
    }

&#39;
curl --unix-socket /srv/jailer/firecracker/551e7604-e35c-42b3-b825-416853441234/root/run/firecracker.socket -i   -X PUT &#39;http://localhost/actions&#39;         -H  &#39;Accept: application/json&#39;            -H  &#39;Content-Type: application/json&#39;      -d &#39;{
      &quot;action_type&quot;: &quot;InstanceStart&quot;
   }&#39;
ps aux | grep jail
ps aux | grep fire
ip addr | less
ping 10.0.0.1
ping 10.0.0.2
pkill firecracker
</code></pre></div>
<div class="highlight"><pre><span></span><code>ip tuntap add tap0 mode tap
ip addr
ip addr | grep bond0
ip addr add 10.0.0.1/24 dev tap0
ip link set tap0 up
sh -c &quot;echo 1 &gt; /proc/sys/net/ipv4/ip_forward&quot;
iptables --help
iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE
iptables -A FORWARD -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT
iptables -A FORWARD -i tap0 -o eth0 -j ACCEPT
ps aux | grep fire
/usr/bin/jailer --id 551e7604-e35c-42b3-b825-416853441234 --exec-file /usr/bin/firecracker --uid 1001 --gid 1111 
rm -rf /srv/jailer/firecracker/551e7604-e35c-42b3-b825-416853441234/root/dev
/usr/bin/jailer --id 551e7604-e35c-42b3-b825-416853441234 --exec-file /usr/bin/firecracker --uid 1001 --gid 1111 
rm -rf /srv/jailer/firecracker/551e7604-e35c-42b3-b825-416853441234/root/run
/usr/bin/jailer --id 551e7604-e35c-42b3-b825-416853441234 --exec-file /usr/bin/firecracker --uid 1001 --gid 1111 
rm -rf /srv/jailer/firecracker/551e7604-e35c-42b3-b825-416853441234/root/run
rm -rf /srv/jailer/firecracker/551e7604-e35c-42b3-b825-416853441234/root/dev
/usr/bin/jailer --id 551e7604-e35c-42b3-b825-416853441234 --exec-file /usr/bin/firecracker --uid 1001 --gid 1111 
</code></pre></div>
                
              
              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../lean/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Lean" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Lean
            </div>
          </div>
        </a>
      
      
        
        <a href="../puppet-jails-deploy/" class="md-footer__link md-footer__link--next" aria-label="Next: Blue/Green deploymetns with Puppet, NGINX and FreeBSD Jails" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Blue/Green deploymetns with Puppet, NGINX and FreeBSD Jails
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        
          Made with
          <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
            Material for MkDocs
          </a>
        
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../assets/javascripts/workers/search.8397ff9e.min.js", "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.1e84347e.min.js"></script>
      
    
  </body>
</html>